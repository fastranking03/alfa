<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alfa Admin | Dashboard</title>
    <%- include('includes/head') %>
        <base href="https://alfa-menswear.com/" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<style>
    .image-input {
        box-sizing: border-box;
        display: inline-block;
        height: 135px;
        border: 1px solid #CCCCCC;
        border-radius: 4px;
        position: relative;
        cursor: pointer;
        box-shadow: 0 1px 10px 0 hsla(0, 0%, 0, 0.15);
        margin: 0 12px 12px 0;
    }

    .image-input::before {
        content: "upload";
        background-image: url($icon);
        display: inline-block;
        position: absolute;
        width: 40px;
        height: 40px;
        left: 52%;
        top: 52%;
        opacity: 0.3;
        transition: opacity 200ms;
        transform: translate(-50%, -50%);
    }

    .isUploading::after {
        content: "";
        display: inline-block;
        position: absolute;
        width: 30px;
        height: 30px;
        left: 32px;
        top: 32px;
        opacity: 0.3;
        border-radius: 50%;
        border: 2px solid;
        border-color: transparent currentColor currentColor;
        animation: spin 600ms linear infinite;
    }

    .isUploading::before {
        display: none;
    }

    input[type=file] {
        opacity: 0;
        display: block;
        height: 100px;
        pointer-events: none;
    }

    .c-img {
        position: absolute;
        display: block;
        border-radius: 4px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        transition: opacity 200ms;
        opacity: 1;
        object-fit: contain;
        object-position: center;
        background: white;
        z-index: 1;
    }

    .c-img img[src=""] {
        opacity: 0;
        pointer-events: none;
    }

    .image-input.main-image-input {
        width: 100%;
        height: 350px;
    }
</style>

<body>
    <div class="main-admin-wrapper">
        <%- include('includes/header') %>
            <div class="alfa-admin-wrapper">
                <div class="admin-side-nav">
                    <%- include('includes/sidebar') %>
                        <div class="admin-main-layout">
                            <div class="admin-breadcrumb">
                                <div class="admin-breadcrumb-title">
                                    <h4>Add New Product</h4>
                                </div>
                            </div>
                            <div class="admin-card">
                                <!-- Add Product Form -->
                                <form action="/admin/add-new-test" method="POST" class="row g-3"
                                    enctype="multipart/form-data">
                                    <div class="add-more-data" id="products">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="product_name" class="form-label">Product Name:</label>
                                                <input type="text" id="product_name" name="product_name[]"
                                                    class="form-control" required>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="product_title" class="form-label">Product Title:</label>
                                                <input type="text" id="product_title" name="product_title[]"
                                                    class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-12">
                                                <label for="product_description" class="form-label">Product
                                                    Description:</label>
                                                <textarea id="product_description" name="product_description[]"
                                                    class="form-control" required></textarea>
                                            </div>
                                        </div>

                                        <div class="product-title-text mt-3">
                                            <h4>Pricing</h4>
                                        </div>
                                        <div class="product-detail product" id="products">
                                            <div class="">
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">MRP</label>
                                                        <input type="text" name="product_price[]" class="form-control"
                                                            placeholder="Enter Product MRP">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">Discount</label>
                                                        <input type="text" name="discount_on_product[]"
                                                            class="form-control" placeholder="Enter  Discount">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">Color</label>
                                                        <input type="text" name="colour[]" class="form-control"
                                                            placeholder="Enter Product Color" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="product-title-text mt-4">
                                                <h4>Size Detail</h4>
                                            </div>

                                            <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="product-cart-wrap">
                                                        <div class="product-title-text">
                                                            <h4>Media</h4>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="from-group">
                                                                    <label class="image-input main-image-input">
                                                                        <input type="file" name="product_main_image[]"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="product_main_image">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="image-grid-wrapper" style="display: flex;">
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image1[]"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image2[]"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image3[]"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image4"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image5"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">

                                                </div>
                                            </div>
                                            <div class="mt-2" style="display: flex; justify-content: end;">
                                                <button type="button" class="btn-submit" onclick="addProductForm()">Add
                                                    More
                                                    Product</button>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn"
                                    style="color: aliceblue; background-color: rgb(15, 13, 13);">Add Product</button>
                            </div>

                            </form>
                        </div>
                </div>
            </div>
    </div>
    </div>

    <script>
        function ImageInput(element) {
            // Variables
            var $wrapper = element;
            var $file = $wrapper.querySelector('input[type=file]');
            var $input = $wrapper.querySelector('input[type=hidden]');
            var $img = $wrapper.querySelector('img');
            var maxSize = Number($file.getAttribute('max-size'));
            var types = $file.accept.split(',');

            var api = {
                onInvalid: onInvalid,
                onChanged: onChanged,
            };

            // Methods
            function fileHandler(e) {
                var file = $file.files.length && $file.files[0];

                if (!file) return;

                var errors = checkValidity(file);

                if (errors) {
                    api.onInvalid(errors);
                    $file.value = null;
                    return;
                }

                api.onChanged(file, update, $wrapper);
            }

            function humanizeFormat(string) {
                return string.replace(/.*?\//, '');
            }

            function checkValidity(file) {
                var errors = [];

                types.includes(file.type) || errors.push('Format file harus: ' + types.map(humanizeFormat).join(', '));
                file.size < maxSize || errors.push('Ukuran file maksimal ' + maxSize / 1000000 + 'MB');

                return errors.length ? errors : false;
            }

            function getFileData(file, callback) {
                var reader = new FileReader();

                reader.addEventListener("load", function () {
                    callback(reader.result);
                }, false);

                if (file) {
                    reader.readAsDataURL(file);
                }
            }

            function update(data) {
                $img.src = data;
                $input.value = data;
            }

            function onInvalid(errors) {
                alert(errors.join('. '));
            }

            function onChanged(file, update, $wrapper) {
                console.log('.onChanged called');
                getFileData(file, update);
            }

            // Init
            $file.addEventListener('change', fileHandler);

            return api;
        };

        function initImageInputs() {
            document.querySelectorAll('.image-input').forEach(_ => {
                var imageInput = new ImageInput(_);
                _.addEventListener("click", (e) => {
                    if (e.target.classList.contains('image-remove')) {
                        _.remove();
                    }
                });

                if (_.classList.contains('withAjax')) {
                    imageInput.onChanged = customOnChanged;
                }

                function customOnChanged(file, update, $el) {
                    if (!$el.nextElementSibling) {
                        var $remove = document.createElement('button');
                        $remove.className = "image-remove";

                        var $new = $el.cloneNode(true);
                        $new.querySelector('input[type=hidden]').value = "";
                        $new.querySelector('input[type=file]').value = "";
                        $new.querySelector('img').src = "";

                        $el.parentElement.append($new);
                        $el.append($remove);

                        var imageInput = new ImageInput($new);
                        imageInput.onChanged = customOnChanged;
                    }

                    $el.classList.add('isUploading');
                    setTimeout(function () {
                        update('https://placekitten.com/200/300');
                        $el.classList.remove("isUploading");
                    }, 3000);
                }
            });
        }

        let productIndex = 1;

        function addProductForm() {
            const productsContainer = document.getElementById("products");

            const productTemplate = `  <div class="add-more-data product" id="products">
                                        <div class="row">
                                              <div class="col-md-3">
                                                <label for="product_name" class="form-label">Product Name:</label>
                                                <input type="text" id="product_name" name="product_name[]"
                                                    class="form-control" required>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="product_title" class="form-label">Product Title:</label>
                                                <input type="text" id="product_title" name="product_title[]"
                                                    class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-12">
                                                <label for="product_description" class="form-label">Product
                                                    Description:</label>
                                                <textarea id="product_description" name="product_description[]"
                                                    class="form-control" required></textarea>
                                            </div>
                                        </div>
                                         
                                        <div class="product-title-text mt-3">
                                            <h4>Pricing</h4>
                                        </div>
                                        <div class="product-detail product" id="products">
                                            <div class="">
                                            </div>
                                            <div class="row mt-2">
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">MRP</label>
                                                        <input type="text" name="product_price[]" class="form-control"
                                                            placeholder="Enter Product MRP">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">Discount</label>
                                                        <input type="text" name="discount_on_product[]"
                                                            class="form-control" placeholder="Enter  Discount">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="from-group">
                                                        <label for="Catename">Color</label>
                                                        <input type="text" name="colour[]" class="form-control"
                                                            placeholder="Enter Product Color" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="product-title-text mt-4">
                                                <h4>Size Detail</h4>
                                            </div>

                                             <div class="row mt-3">
                                                <div class="col-md-6">
                                                    <div class="product-cart-wrap">
                                                        <div class="product-title-text">
                                                            <h4>Media</h4>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="from-group">
                                                                    <label class="image-input main-image-input">
                                                                        <input type="file" name="product_main_image[]"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden"
                                                                            name="product_main_image[]">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="image-grid-wrapper" style="display: flex;">
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image1"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image2"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image3"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image4"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                                <div class="image-items">
                                                                    <label class="image-input">
                                                                        <input type="file" name="image5"
                                                                            accept="image/png,image/jpeg"
                                                                            max-size="10000000">
                                                                        <input type="hidden" name="">
                                                                        <img class="c-img" src="" alt="">
                                                                    </label>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">

                                                </div>
                                            </div>
                                            <div class="mt-2" style="display: flex; justify-content: end;">
                                               <button type="button" class="btn-submit btn-danger" onclick="removeProduct(this)">Remove</button>
                                            </div>
                                        </div>
                                    </div>
            `;
            const productNode = document.createElement("div");
            productNode.innerHTML = productTemplate.trim();
            productsContainer.appendChild(productNode.firstChild);

            productIndex++;

            initImageInputs(); // Reinitialize the image inputs
        }

        function removeProduct(button) {
            const productDiv = button.closest(".product");
            productDiv.remove();
        }



        // Initialize image inputs for existing elements
        initImageInputs();
    </script>
</body>

</html>