<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alfa Meanswear | My Cart</title>
    <%- include('includes/head') %>
</head>

<body>
    <div class="alfa-main-wraper">
        <%- include('includes/header') %>
        <div class="mt-100 mt-150">
            <div class="checkout-wrapper margin-160">
                <div class="container">
                    <div class="checkout-title">
                        <h3>Shopping Cart</h3>
                    </div>
                    <div class="container mt-3">
                        <form id="orderForm" action="place-order" method="post"   >
                            <div class="row">
                                <div class="col-md-7">
                                    <div class="alfa-cart-items cart-right-wrap">
                                        <div class="cart-table">
                                            <div class="cart-head">
                                                <div class="cart-tr">
                                                    <div class="cart-th" style="width: 27%;">Products</div>
                                                    <div class="cart-th">Price</div>
                                                    <div class="cart-th">Quantity</div>
                                                    <div class="cart-th">Size</div>
                                                    <div class="cart-th">Sub-Total</div>
                                                </div>
                                            </div>
                                            <div class="cart-tbody">
                                                <% cartItems.forEach((item, index) => { %>
                                                <div class="cart-tr cart-b-tr">
                                                    <div class="cart-td">
                                                        <div class="cart-items-left">
                                                            <div class="cart-delete">
                                                                <a href=""><span><i class="fa-regular fa-circle-xmark"></i></span></a>
                                                            </div>
                                                            <div class="cart-image">
                                                                <img src="../product_images/<%=item.product_main_image %>" class="cart-img" alt="">
                                                            </div>
                                                            <div class="pro-cart-contents">
                                                                <div class="pro-cart-title">
                                                                    <h3><%= item.product_name %></h3>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="cart-td">
                                                        <div class="pro-cart-price">
                                                            <h3>£<%= item.product_price %></h3>
                                                        </div>
                                                    </div>
                                                    <div class="cart-td">
                                                        <div class="cart-quantity-wrapper">
                                                            <div class="left-input">
                                                                <span><i class="fa-solid fa-minus"></i></span>
                                                            </div>
                                                            <div class="cart-quantity">
                                                                <input type="number" name="products[<%=index%>][quantity]" value="1" class="cart-value" min="1">
                                                            </div>
                                                            <div class="right-input">
                                                                <span><i class="fa-solid fa-plus"></i></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="cart-td"> 
                                                        <input type="text"  name="products[<%=index%>][size]" value="<%= item.selected_size ? item.selected_size : 'S' %>" class="cart-value"  > 
                                                    </div>
                                                    <div class="cart-td">
                                                        <div class="pro-cart-price">
                                                            <h3>£<span class="subtotal"><%= item.product_price %></span></h3>
                                                        </div>
                                                    </div>
                                                    <input type="hidden" name="products[<%=index%>][productId]" value="<%= item.product_id %>">
                                                    <input type="hidden" name="products[<%=index%>][price]" value="<%= item.product_price %>">
                                                </div>
                                                <% }); %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="alfa-offcanvas-footer cart-left-wrap">
                                        <div class="checkout-title">
                                            <h4>Order Summary</h4>
                                        </div>
                                        <div class="promo-code-wrap">
                                            <input type="text" class="promo-input" placeholder="Promo Code" />
                                            <button type="submit" class="apply-btn" name="submit">Apply</button>
                                        </div>
                                        <%
                                            let totalPrice = 0;
                                            cartItems.forEach(item => {
                                                totalPrice += parseFloat(item.product_price);
                                            });
                                            const GST = totalPrice * 0.2; // 20% GST
                                            const deliveryFee = 25;
                                            const totalCost = totalPrice + GST + deliveryFee;
                                        %>
                                        <div class="alfa-cart-total">
                                            <ul>
                                                <li>
                                                    <div class="alfa-text">Sub-Total</div>
                                                    <div class="alfa-price">£ <%= totalPrice %></div>
                                                </li>
                                                <li>
                                                    <div class="alfa-text">GST</div>
                                                    <div class="alfa-price">£ <%= GST %></div>
                                                </li>
                                                <li>
                                                    <div class="alfa-text">Delivery Fee</div>
                                                    <div class="alfa-price">£ <%= deliveryFee %></div>
                                                </li>
                                            </ul>
                                        </div>
                                        
                                        <div class="alfa-cart-total">
                                            <ul>
                                                <li>
                                                    <div class="alfa-text">Total Cost</div>
                                                    <div class="alfa-price">£ <%= totalCost %></div>
 
                                                </li>
                                            </ul>
                                        </div>
                                        <hr>
                                        <div class="address-title text-center">
                                          <h3>Address</h3>
                                          <div id="addressDetails">
                                            <label for="address_id">Select Address for Delivery:</label>
                                            <select name="address_id" id="address_id" required>
                                              <% addresses.forEach(address => { %>
                                                <option value="<%= address.id %>">
                                                  <%= address.name %> - <%= address.address_title %> - <%= address.city %>
                                                </option>
                                              <% }); %>
                                            </select>
                                          </div>
                                        </div>
                                        <br>
                                        <div class="alfa-checkout-wrapper">
                                            <button type="submit" class="checkout-btn">Proceed to Checkout</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" name="subtotal" value="<%= totalPrice %>">
                            <input type="hidden" name="gst" value="<%= GST %>">
                            <input type="hidden" name="deliveryFee" value="<%= deliveryFee %>">
                            <input type="hidden" name="totalCost" value="<%= totalCost %>">

                        </form>
                    </div>
                </div>
            </div>
        </div>
       <%=JSON.stringify(cartItems)  %> 
        <!-- Footer -->
        <%- include('includes/footer') %>
        <!-- End -->
    </div>
    <%- include('includes/foot') %>

  </body> 
</html>
