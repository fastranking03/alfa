<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="http://localhost:8081" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alfa Meanswear | Product</title>
    <meta name="robots" content="noindex" />
    <%- include('includes/head') %>
    <style>
      /* Hide the default checkbox */
      .size-checkbox {
        opacity: 0;
        position: absolute;
        width: 0;
        height: 0;
      }
       
      .size-checkbox:checked + label {
        background-color: #005d67;  
        border-color: #005d67;  
        color: #fff !important;
      }

      /* Style the label text */
      .size-checkbox + label::after {
        content: "";
        display: block;
        width: 100%;
        height: 100%;
        background-image: url("checkmark.png");  
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
      }
    </style>
  </head>

  <body>
    <div class="alfa-main-wraper">
      <%- include('includes/header') %>
      <div class="mt-100">
        <div class="product-banner">
          <div class="container">
            <div class="hero-product-rows">
              <div class="product-col-6">
                <div class="breadcrubm-text">
                  <h2>Shop</h2>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Start -->
        <section class="mt-50" style="margin-bottom: 145px">
          <div class="product-wrapper">
            <div class="custom-container">
              <div class="product-row">
                <div class="product-md-3">
                  <div class="product-left-wrapper">
                    <div class="product-search">
                      <div class="search-title">
                        <h4 class="product-h4">Search Products</h4>
                      </div>
                      <div class="product-search">
                        <span class="p-s-icon"
                          ><img src="assets/images/search.png" alt=""
                        /></span>
                        <input
                          type="search"
                          name="search"
                          class="product-search-control"
                          placeholder="Search for products"
                          id=""
                        />
                      </div>
                    </div>
                    <div class="product-category mt-4">
                      <div class="cat-title">
                        <h4 class="product-h4">Categories</h4>
                      </div>
                      <div class="product-cat-type">
                        <ul class="product-cat-list">
                          <% categories.forEach(category=> { %>
                          <li>
                            <a href="category/<%= category.category_name %>"
                              ><button class="cat-item">
                                <%= category.category_name %>
                                <span class="cat-span">( <%=category.product_count %> )</span
                                >
                              </button></a
                            >
                          </li>
                          <% }); %>
                        </ul>
                      </div>
                    </div>
                    <div class="product-color">
                      <div class="color-title">
                        <h4 class="product-h4">Color</h4>
                      </div>

                      <div class="product-color-list">
                        <ul>
                          <li>
                            <div class="prouduct-checkout">
                              <input  type="checkbox"  class="cat-checkbox"  id="blueCheckbox" value="blue" data-colour="colour"  />
                              <a class="product-color-item color1"> </a>
                              <label for="blueCheckbox" class="color-label" >Blue</label>
                            </div>
                          </li>
                          <li>
                            <div class="prouduct-checkout">
                              <input  type="checkbox" class="cat-checkbox" id="whiteCheckbox" value="white" data-colour="colour" />
                              <a href="" class="product-color-item color4"> </a>
                              <label for="whiteCheckbox" class="color-label">White</label>
                            </div>
                          </li>
                          <li>
                            <div class="prouduct-checkout">
                              <input  type="checkbox"  class="cat-checkbox" id="purpleCheckbox" value="purple" data-colour="colour" />
                              <a href="" class="product-color-item color3"> </a>
                              <label for="purpleCheckbox" class="color-label" >Purple</label>
                            </div>
                          </li>

                          <li>
                            <div class="prouduct-checkout">
                              <input   type="checkbox"
                                class="cat-checkbox"
                                id="pinkCheckbox"
                                value="pink"
                                data-colour="colour"
                              />
                              <a href="" class="product-color-item color4"> </a>
                              <label for="pinkCheckbox" class="color-label"
                                >Pink</label
                              >
                            </div>
                          </li>
                          <li>
                            <div class="prouduct-checkout">
                              <input
                                type="checkbox"
                                class="cat-checkbox"
                                id="yellowCheckbox"
                                value="yellow"
                                data-colour="colour"
                              />
                              <a href="" class="product-color-item color4"> </a>
                              <label for="yellowCheckbox" class="color-label"
                                >Yellow</label
                              >
                            </div>
                          </li>
                          <li>
                            <div class="prouduct-checkout">
                              <input
                                type="checkbox"
                                class="cat-checkbox"
                                id="brownCheckbox"
                                value="brown"
                                data-colour="colour"
                              />
                              <a href="" class="product-color-item color4"> </a>
                              <label for="brownCheckbox" class="color-label"
                                >Brown</label
                              >
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>

                    <div class="product-size">
                      <div class="filter-title">
                        <h4 class="product-h4">Size</h4>
                      </div>
                      <div class="product-size-list">
                        <ul id="sizeFilters">
                          <li>
                            <div class="product-checkout">
                              <input
                                type="checkbox"
                                class="size-checkbox"
                                id="sizeS"
                                value="S"
                              />
                              <label for="sizeS" class="size-item">S</label>
                            </div>
                          </li>
                          <li>
                            <div class="product-checkout">
                              <input
                                type="checkbox"
                                class="size-checkbox"
                                id="sizeM"
                                value="M"
                              />
                              <label for="sizeM" class="size-item">M</label>
                            </div>
                          </li>
                          <li>
                            <div class="product-checkout">
                              <input
                                type="checkbox"
                                class="size-checkbox"
                                id="sizeL"
                                value="L"
                              />
                              <label for="sizeL" class="size-item">L</label>
                            </div>
                          </li>
                          <li>
                            <div class="product-checkout">
                              <input
                                type="checkbox"
                                class="size-checkbox"
                                id="sizeXL"
                                value="XL"
                              />
                              <label for="sizeXL" class="size-item">XL</label>
                            </div>
                          </li>
                          <li>
                            <div class="product-checkout">
                              <input
                                type="checkbox"
                                class="size-checkbox"
                                id="sizeXXL"
                                value="XXL"
                              />
                              <label for="sizeXXL" class="size-item">XXL</label>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>

                    <div class="product-filter">
                      <div class="filter-title">
                          <h4 class="product-h4">Filter by price</h4>
                      </div>
                      <div class="price-range-wrapper">
                          <div class="price-slider">
                              <div class="price-range-slider">
                                  Price:
                                  <span class="rangeValues"> </span>
                                  <input value="10" min="10" max="100" step="10" class="price-range-input" type="range">
                                  <input value="100" min="10" max="100" step="10" class="price-range-input" type="range">
                              </div>
                          </div>
                      </div>
                  </div>
                  </div>


                </div>
                <div class="product-md-9">
                  <div class="product-right-wrapper">
                      <div class="product-grid">
                      <% products.forEach(product=> { %>
                      <div
                        class="product-item"
                        data-color="<%= product.colour %>"
                      >
                        <div class="produt-wrap">
                          <a href="/product-detail/<%= product.id %> ">
                            <img
                              src="../product_images/<%= product.product_main_image%> %>"
                              class="pro-img"
                              alt=""
                            />
                          </a>
                         </div>
                        <div class="product-add-to-card-wrap">
                          <button
                            class="add-to-cart"
                            data-product-id="<%= product.id %>"
                          >
                            <span
                              ><i class="fa-solid fa-cart-shopping"></i
                            ></span>
                            Add to Cart
                          </button>
                        </div>
                        <div class="product-details shop-content">
                          <div class="product-nameprice">
                            <a href="/product-detail/<%= product.id %>">
                              <h6><%= product.product_name %></h6>
                              <p class="product-short-desc">
                                Lorem ipsum dolor sit...
                              </p>
                            </a>

                            <div class="product-price">
                              <h5>
                                <span class="final-price"
                                  >£<%=(product.product_price * (1 -
                                  (product.discount_on_product /
                                  100))).toFixed(2) %></span
                                >
                                <span class="mrp-price">
                                  £<%=product.product_price %></span
                                >
                                <span class="discount-text">
                                  (<%=product.discount_on_product %>% OFF
                                  )</span
                                >
                              </h5>
                            </div>
                          </div>
                          <div class="product-btn">
                            <div class="pro-whishlist">
                              <a
                                class="add-to-favorites"
                                data-product-id="<%= product.id %>"
                              >
                                <i class="fa-regular fa-heart"></i>
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>
                      <% }); %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- End -->
      </div>
      <!-- Footer -->
      <%- include('includes/footer') %>

      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
        $(document).ready(function () {
          const productItems = $(".product-item");
          const colorCheckboxes = $(".cat-checkbox");

          colorCheckboxes.on("change", function () {
            var selectedColors = []; // Array to store selected colors

            // Loop through all checkboxes to find selected colors
            colorCheckboxes.each(function () {
              if ($(this).is(":checked")) {
                selectedColors.push($(this).val()); // Add selected color to array
              }
            });

            productItems.each(function () {
              var productColor = $(this).data("color");

              // Show products if any selected color matches product color, or if "All Colors" is checked
              if (
                selectedColors.length === 0 ||
                selectedColors.includes(productColor)
              ) {
                $(this).show();
              } else {
                $(this).hide();
              }
            });
          });
        });
      </script>

      <!-- End -->
      <script>
        // Add event listener to the "Add to Favorites" button
        document.addEventListener("DOMContentLoaded", function () {
          const addToFavoritesButtons =
            document.querySelectorAll(".add-to-favorites");

          addToFavoritesButtons.forEach((button) => {
            button.addEventListener("click", function () {
              const productId = button.getAttribute("data-product-id");

              // Send AJAX request to the server
              fetch(`/favorites/add/${productId}`, {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
                credentials: "same-origin", // include cookies
              })
                .then((response) => {
                  if (!response.ok) {
                    throw new Error("Network response was not ok");
                  }
                  return response.json();
                })
                .then((data) => {
                  if (data.success) {
                    // Show popup alert
                    alert(data.message);

                    // Update wishlist count in the span
                    const wishlistLi = document.querySelector("#wishlist");
                    if (wishlistLi) {
                      const countTextSpan =
                        wishlistLi.querySelector(".count-text");
                      if (countTextSpan) {
                        countTextSpan.textContent = data.favoritesCount;
                      }
                    }
                  } else {
                    alert(data.message);
                  }
                })
                .catch((error) => {
                  console.error(
                    "There was a problem with the fetch operation:",
                    error
                  );
                  // Handle error
                  alert(
                    "An error occurred while adding the product to favorites"
                  );
                });
            });
          });
        });
      </script>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const addToCartButtons = document.querySelectorAll(".add-to-cart");

          addToCartButtons.forEach((button) => {
            button.addEventListener("click", addToCart);
          });

          async function addToCart(event) {
            const productId =
              event.currentTarget.getAttribute("data-product-id");
            try {
              const response = await fetch(`/cart/add/${productId}`, {
                method: "GET",
              });
              const result = await response.json();
              if (result.success) {
                alert(result.message);
                // Update cart count in the span
                const cartLi = document.querySelector("#cart");
                if (cartLi) {
                  const countTextSpan = cartLi.querySelector(".product-count");
                  if (countTextSpan) {
                    // countTextSpan.textContent = data.favoritesCount;
                    countTextSpan.textContent = result.CartCount;
                  }
                }
              } else {
                alert(result.message);
              }
            } catch (error) {
              console.error("Error:", error);
              alert("An error occurred while adding the product to cart");
            }
          }
        });
      </script>
    </div>
    <%- include('includes/foot') %>
    <script>
      // document.addEventListener("DOMContentLoaded", function() {
      //       const productGrid = document.querySelector(".product-grid");
      //       const productItems = document.querySelectorAll(".product-item");
      //       console.log(productItems.length)
      //        if (productItems.length < 5) {
      //           productGrid.style.justifyContent = "start";
      //       } else {
      //           productGrid.style.justifyContent = "space-between";
      //       }
      //   });
    
</script>
  </body>
</html>
